import { FullScreenCode, Head, Image, SplitRight } from 'mdx-deck'
import Theme from './src/index'
import { Card, SplitLeftAlign } from './src/index'
export const theme = Theme

<Head>
  <title>Moving the AgilityNerd Blog to GatsbyJS</title>
</Head>

---

# Moving the AgilityNerd Blog to GatsbyJS

## Steve Schwarz

#### NWCJS Meetup - Nov-2019

---
import stevesnap from './images/steve-snap.jpg'

<SplitRight>

<div style="position:relative">
<Image src={stevesnap} size="contain" style={{height: '90vh', marginLeft: '1em'}} title="Copyright Chops Photography"/>
<a style="position:absolute;bottom:5em;left:0;width:100%;font-size:0.5em" href="https://chopsphoto.com">Photo Copyright Chops Photography</a>
</div>

<div style="padding: 0 1em">

#### @steveaschwarz

<div style="text-align: left">

Professional software developer since 1991.

15 yr C/C++ client-server dev: factory automation and futures/options trading.

12+ yr web dev: Python, JavaScript, Angular, VueJS

20+ yr hobby: dog agility and web dev: [agilitynerd.com](https://www.agilitynerd.com),  [tech.agilitynerd.com](https://tech.agilitynerd.com), [googility.com](https://googility.com), [agilitycourses.com](https://agilitycourses.com) & [agilitycoursemaster.com](https://agilitycoursemaster.com)

</div>

</div>

</SplitRight>

---

import legacyagilitynerd from './images/legacy-agilitynerd.png'

<SplitLeftAlign style="width:100%">

<div style="height:100vh">
<Image src={legacyagilitynerd} size="contain"></Image>
</div>

<div style="text-align: left;padding-left:1em;">
<h3>AgilityNerd Blog</h3>
<ul>
<li>Started in 2004</li>
<li>Oldest dog agility blog</li>
<li>Hierarchical categories, tags, pages automatically cross linked</li>
<li>800 blog posts</li>
<li>1600 total pages</li>
<li>12,000 FB followers</li>
</ul>
</div>

</SplitLeftAlign>

---

## Why Change?

- 1990s technology - extending difficult
- Complex installation - stuck on expensive VPS
- Terrible authoring experience:
  - Raw HTML
  - No Preview
  - FTP deploy
- Poor performance

---

## Existing Technology

- **Content in directories of flat files**
- Perl CGI Script (Blosxom) / plugins
- FastCGI
- NGINX caching
- Linux VPS

---

## Decided on a JAMstack Solution

- JavaScript
- APIs
- Markup

---

import jamstack from './images/jamstack.png'

<Image src={jamstack} size="contain" style={{height: '100vh', zIndex: 10}}/>

---

## JAMstack Provides:

- Performance: Generate all/most pages at build time
- Scaling: Stateless servers and CDNs
- Security: No server code running smaller attack surface
- Improved Developer Experience

https://jamstack.org

---
import gatsbyicon from './images/Gatsby_Monogram.png'

<Image src={gatsbyicon} size='contain' style="display:block;height:150px"/>

## Gatsby JS

- Open source: https://gatsbyjs.org
- Created by Kyle Mathews [@kylemathews](https://twitter.com/kylemathews)
- MIT license
- Great documentation!
- Supported by services: https://gatsbyjs.com

---

## Gatsby and the JAMStack model:
- Combines multiple data sources
- Unified data access model: GraphQL
- Generate all pages at build time
- React client hydrates pages/prefetches links: **Fast**
- Git or hook based deploys
- Real time preview/hot reload

---

## Use Gatsby For:

- Portfolio, brouchure, blogs
- Excels at content obtained at build time
- Hybrid sites: include client side JS to communicate with APIs
- New data? Regenerate and re-deploy

---

# Gatsby in Action

[agilitynerd.com](https://www.agilitynerd.com)

- Lighthouse performance score
- Image blur up on load
- Prefetches linked content on scroll
- Progressive Web App (PWA)

---

import howgatsbyworks from './images/how-gatsby-works.png'

<Image src={howgatsbyworks} size="contain" style={{height: '99vh', zIndex: 10}}/>

---

## Getting Started

```
npm install -g gatsby-cli

gatsby new my-blog-starter https://github.com/gatsbyjs/gatsby-starter-blog

cd my-blog-starter

gatsby develop
```

https://github.com/gatsbyjs/gatsby-starter-blog

---

## Data Source Plugins Provide Content

- Markdown, MDX (Markdown + JSX), YAML, CSV, JSON, etc. from files
- Images
- Content Management Systems
- Twitter, FB, GitHub, Instagram feeds
- Over 400 data source plugins:

https://www.gatsbyjs.org/plugins/?=source

---

## Using Data Sources

- Configured in `gatsby-config.js`
- Gatsby uses data sources to create GraphQL nodes

---

## Generate pages using Gatsby API

- In `gatsby-node.js`:
  - Export `createPages` function that builds all pages
  - Call Gatsby's `createPage()` with GraphQL results

---

<FullScreenCode>

```js
exports.createPages = async ({ graphql, actions }) => {
  const result = await graphql(
    `{
      allMdx(sort: {fields: [frontmatter___date], order: DESC},
      filter: {frontmatter: {date: {ne: null}, draft: {ne: true}}}) {
        edges {
          node {
            id
            fields {
              slug
            }
            frontmatter {
              title
              date
              tags
            }
          }
        }
      }
      tagsGroup: allMdx(
        filter: {frontmatter: {date: {ne: null}, draft: {ne: true}}}) {
        group(field: frontmatter___tags) {
          fieldValue
        }
      }
    }`
  )
```
</FullScreenCode>

---

## Test/Fine Tune GQL Queries

[GraphiQL](http://localhost:8000/___graphql?query=query%20MyQuery%20%7B%0A%20%20allMdx(sort%3A%20%7Bfields%3A%20%5Bfrontmatter___date%5D%2C%20order%3A%20DESC%7D%2C%20filter%3A%20%7Bfrontmatter%3A%20%7Bdate%3A%20%7Bne%3A%20null%7D%2C%20draft%3A%20%7Bne%3A%20true%7D%7D%7D)%20%7B%0A%20%20%20%20edges%20%7B%0A%20%20%20%20%20%20node%20%7B%0A%20%20%20%20%20%20%20%20id%0A%20%20%20%20%20%20%20%20fields%20%7B%0A%20%20%20%20%20%20%20%20%20%20slug%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20frontmatter%20%7B%0A%20%20%20%20%20%20%20%20%20%20title%0A%20%20%20%20%20%20%20%20%20%20date%0A%20%20%20%20%20%20%20%20%20%20tags%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20tagsGroup%3A%20allMdx(filter%3A%20%7Bfrontmatter%3A%20%7Bdate%3A%20%7Bne%3A%20null%7D%2C%20draft%3A%20%7Bne%3A%20true%7D%7D%7D)%20%7B%0A%20%20%20%20group(field%3A%20frontmatter___tags)%20%7B%0A%20%20%20%20%20%20fieldValue%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A&operationName=MyQuery)

---

<FullScreenCode>

```
// Create individual blog posts pages.

posts.forEach((post, index) => {
  const previous = index === posts.length - 1 ? null : posts[index + 1].node
  const next = index === 0 ? null : posts[index - 1].node
  const slug = post.node.fields.slug
  createPage({
    path: slug,
    component: slug.includes('/static/') ? staticPost : blogPost, // template component
    context: {  // component props
      slug: slug,
      previous,
      next,
    },
  })
})
```

</FullScreenCode>

---

## Templates

- React components
- Can contain additional GraphQL queries

`src/templates/static-post.js`

---

## Create/Use React Components Everywhere

Create your own:
  ```
  <TagCloud>
  <TagList>
  <Breadcrumbs>
  <Categories>
  ```

Use 3rd Party Components

Gatsby + MDX => components in your Markdown

---

## Plugins Can Do More

<SplitLeftAlign>

<div>

- During generation:
  - RSS Feeds
  - Image Processing
  - SASS
  - Sitemap
  - Robots.txt
  - Manifest

</div>

<div>

- Client-side:
  - Analytics
  - Search
  - Offline mode
  - Crash monitoring

</div>

</SplitLeftAlign>

---

## Deploy

- Gatsby sites only need static hosting!
- GitHub pages, AWS, Azure, Zeit, Netlify, Cloudflare, Google Cloud, etc.
- Trigger build via Git commit hook
- Auto deploy

---

## Gatsby Themes

- Packages reusable plugins, styling, queries
- More than a traditional "theme"

---

## Gatsby Future

- Gatsby Cloud
- Large site performance

---

## Wait, There's More Gatsby!

<div style="text-align: left">

1. Slide Deck Built with [mdx-deck](https://github.com/jxnblk/mdx-deck)

Built on Gatsby

2. Source on GitHub:

https://github.com/saschwarz/nwjs-gatsby

3. Commit/Push Builds/Deploys to [Netlify](https://netlify.com)

https://nwcjs-gatsby.netlify.com

</div>

---
import snapgatsby from './images/snap-gatsby.jpg'

<Image src={snapgatsby} size="contain" style={{height: '80vh'}}>
</Image>

---
