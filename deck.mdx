import { FullScreenCode, Head, Image, SplitRight } from 'mdx-deck'
import Theme from './src/index'
import { Card, SplitLeftAlign } from './src/index'
export const theme = Theme

<Head>
  <title>Moving the AgilityNerd Blog to GatsbyJS</title>
</Head>

---

# Moving the AgilityNerd Blog to GatsbyJS

## Steve Schwarz

#### NWCJS Meetup - Nov-2019

---
import stevesnap from './images/steve-snap.jpg'

<SplitRight>

<div style="position:relative">
<Image src={stevesnap} size="contain" style={{height: '90vh', marginLeft: '1em'}} title="Copyright Chops Photography"/>
<a style="position:absolute;bottom:5em;left:0;width:100%;font-size:0.5em" href="https://chopsphoto.com">Photo Copyright Chops Photography</a>
</div>

<div style="padding: 0 1em">

#### @steveaschwarz

Professional software developer since 1991.

15 yr C/C++ client-server dev: factory automation and futures/options trading.

12+ yr web dev: Python, JavaScript, Angular, VueJS, and Postgres

20+ yr hobby: dog agility and web dev: agilitynerd.com,  tech.agilitynerd.com, googility.com, agilitycourses.com & agilitycoursemaster.com

</div>

</SplitRight>

---
import legacyagilitynerd from './images/legacy-agilitynerd.png'

<SplitLeftAlign>

  <div style="text-align: left;padding-right:1em;">
    <h3>AgilityNerd Blog</h3>
    <ul>
      <li>Started in 2004</li>
      <li>Oldest dog agility blog</li>
      <li>Categories, tags, pages automatically cross linked</li>
      <li>800 blog posts</li>
      <li>1600 total pages</li>
      <li>12,000 FB followers</li>
    </ul>
  </div>

  <Image src={legacyagilitynerd} size="contain"/>

</SplitLeftAlign>

---

## Why Change?

- 1990s technology - extending difficult
- Complex installation - stuck on expensive VPS
- Terrible authoring experience:
  - Raw HTML
  - No Preview
  - FTP deploy
- Poor performance

---

## Existing Technology

- **Content in directories of flat files**
- Perl CGI Script (Blosxom) / plugins
- FastCGI
- NGINX caching
- Linux VPS

---

## Decided on a JAMstack Solution

- JavaScript
- APIs
- Markup

---

import jamstack from './images/jamstack.png'

<Image src={jamstack} size="contain" style={{height: '100vh'}}/>

---

## JAMstack Provides:

- Performance: Generate all/most pages at build time
- Scaling: Stateless servers and CDNs
- Security: No server code running smaller attack surface
- Improved Developer Experience

https://jamstack.org

---

## Gatsby JS

Open source https://gatsbyjs.org

Supported by commercial offerings https://gatsbyjs.com

---

## Fits the JAMStack model:
- Combines multiple data sources
- Unified data access model: GraphQL
- Generate all pages at build time
- React client hydrates pages/prefetches links: **Fast**
- Git or hook based deploys
- Real time preview/hot reload

---

## Use Gatsby For:

- Portfolio, brouchure, blogs
- Excels at content obtained at build time
- Shopping site: client side JS to communicate with APIs
- New data? Regenerate and re-deploy

---

# Gatsby in Action

[agilitynerd.com](https://www.agilitynerd.com)

---

import howgatsbyworks from './images/how-gatsby-works.png'

<Image src={howgatsbyworks} size="contain" style={{height: '100vh'}}/>

---

## Setting Up

- install node and git
```
mkdir my-project && cd my-project

npm install -g gatsby-cli

gatsby develop
```

---

## Starters
blog starter

- pages
- markdown

---

## Set up data sources

`gatsby-config.js`

- Markdown/images from file system
- CMS API(s) to fetch content
- Favorites from google analytics
- YAML, CSV, JSON files

---

## Using Data Sources

- Gatsby data sources create GraphQL nodes
- Query the data via GraphQL
- Interactive testing via GraphiQL explorer:



- Generate pages using Gatsby API in `gatsby-node.js`
- Over 400 data source plugins:

https://www.gatsbyjs.org/plugins/?=source

---

<FullScreenCode>

```js
exports.createPages = async ({ graphql, actions }) => {
  const result = await graphql(
    `{
      allMdx(sort: {fields: [frontmatter___date], order: DESC},
      filter: {frontmatter: {date: {ne: null}, draft: {ne: true}}}) {
        edges {
          node {
            id
            fields {
              slug
            }
            frontmatter {
              title
              date
              tags
            }
          }
        }
      }
      tagsGroup: allMdx(
        filter: {frontmatter: {date: {ne: null}, draft: {ne: true}}}) {
        group(field: frontmatter___tags) {
          fieldValue
        }
      }
    }`
  )
```
</FullScreenCode>

---

## Test/Fine Tune GQL Queries

[GraphiQL](http://localhost:8000/___graphql?query=query%20MyQuery%20%7B%0A%20%20allMdx(sort%3A%20%7Bfields%3A%20%5Bfrontmatter___date%5D%2C%20order%3A%20DESC%7D%2C%20filter%3A%20%7Bfrontmatter%3A%20%7Bdate%3A%20%7Bne%3A%20null%7D%2C%20draft%3A%20%7Bne%3A%20true%7D%7D%7D)%20%7B%0A%20%20%20%20edges%20%7B%0A%20%20%20%20%20%20node%20%7B%0A%20%20%20%20%20%20%20%20id%0A%20%20%20%20%20%20%20%20fields%20%7B%0A%20%20%20%20%20%20%20%20%20%20slug%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20frontmatter%20%7B%0A%20%20%20%20%20%20%20%20%20%20title%0A%20%20%20%20%20%20%20%20%20%20date%0A%20%20%20%20%20%20%20%20%20%20tags%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20tagsGroup%3A%20allMdx(filter%3A%20%7Bfrontmatter%3A%20%7Bdate%3A%20%7Bne%3A%20null%7D%2C%20draft%3A%20%7Bne%3A%20true%7D%7D%7D)%20%7B%0A%20%20%20%20group(field%3A%20frontmatter___tags)%20%7B%0A%20%20%20%20%20%20fieldValue%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A&operationName=MyQuery)

---

<FullScreenCode>

```
// Create individual blog posts pages.

posts.forEach((post, index) => {
  const previous = index === posts.length - 1 ? null : posts[index + 1].node
  const next = index === 0 ? null : posts[index - 1].node
  const slug = post.node.fields.slug
  createPage({
    path: slug,
    component: slug.includes('/static/') ? staticPost : blogPost,
    context: {
      slug: slug,
      previous,
      next,
    },
  })
})
```

</FullScreenCode>

---

## Templates

`src/templates/static-post.js`

---

ReactJS Components

```
<TagCloud>
```

---

MDX + React Components


---

## Plugins

- MDX
- Analytics
- Sitemap
- Search
- Offline
- Manifest
- RSS Feeds
- Image Processing
- SASS

---

## Deploy to Netlify

---

## Gatsby Themes

---

## Gatsby Future

- Gatsby Cloud

- Large site performance

---

# Thanks!

---
